"undefined"==typeof __&&(__={});__.Async=function(a){var b="Async"+ ++__.Async.ix;a=a||{};a.__guid_async__=b;return __.Async.store[b]=new __.Async.Promise(a)};__.Async.ix=0;__.Async.store={};__.Async.fnerr=function(a,b){console.log("[error]",a,b)};__.Async.fnstat=function(){};__.Async.promise=function(a){var b=null;"object"==typeof a&&a.__guid_async__?b=__.Async.store[a.__guid_async__]:(b=new __.Async,b.m=a&&a.cb?a.cb:function(a){console.log(a)});b.j=!0;return b};
__.Async.Promise=function(a){this.__guid_async__=a.__guid_async__;this._args={__guid_async__:this.__guid_async__};this.a=[];this.g=this.i=!1;this.ctx=a&&a.ctx?a.ctx:window;this.id=a&&a.id?a.id:this.__guid_async__;this.sdftError=a&&a.sdftError?a.sdftError:"";this.fnerr=a&&a.fnerr?a.fnerr:__.Async.fnerr;this.fnstat=a&&a.fnstat?a.fnstat:__.Async.fnstat;return this};
__.Async.Promise.prototype={h:0,ix:0,j:!1,debug:function(){this.i=!0;return this},clear:function(){var a=this;f(this,{ctx:this.ctx,b:function(){a._args={__guid_async__:a.__guid_async__};a.resolve()},c:{}});return this},pause:function(a,b){var c=this;f(this,{ctx:this.ctx,b:function(){setTimeout(function(){c.resolve()},a)},c:{},f:b||"pause"});return this},wait:function(a,b,c){var d=this,e="number"==typeof b?b:25;f(this,{ctx:this.ctx,b:function(){function b(){a()?d.resolve():setTimeout(b,e)}b()},c:{},
f:"string"==typeof b?b:c?c:"wait"});return this},"try":function(){var a=this;f(this,{ctx:this.ctx,b:function(){a.g=!0;a.resolve()},c:{}});return this},"catch":function(a){var b=this;f(this,{ctx:this.ctx,b:a||function(){b.resolve()},c:{},o:!0});return this},when:function(a,b){var c=this._args,d=this;this.then(function(){var b=__.Async.promise(c),h=a.length;a.forEach(function(a){a.l=d;a.then(function(d){delete d.__guid_async__;for(var e in d)c[e]=d[e];0==--h&&b.resolve();a.resolve()},"done");a.start()})},
b||"");return this},then:function(a,b,c,d){f(this,{ctx:"object"==typeof a?a:this.ctx,b:"object"==typeof a?b:a,c:"string"==typeof b?"object"==typeof c?c:{}:b?b:{},f:"object"==typeof c?d:"string"==typeof c?c:"string"==typeof b?b:""});return this},_next:function(){var a=this.a.shift();if(a.o&&this.g)this._next();else{this.u=a.f;this.ix++;g(this,a.f);for(var b in a.c){var c=a.c[b];if("object"==typeof c&&c&&c.arg){var d=c.arg.split(".");c=this._args;d.forEach(function(a){c=c[a]})}this._args[b]=c}if("string"==
typeof a.b)a.ctx[a.b](this._args);else a.b.call(a.ctx,this._args)}},start:function(){this._next();return this},resolve:function(a){this.j=!1;this.a.forEach(function(a){a.s=!1});for(var b in a)this._args[b]=a[b];0<this.a.length?this._next():(this.i||delete __.Async.store[this.__guid_async__],this.m&&this.m(a))},stop:function(){this.i||delete __.Async.store[this.__guid_async__]},reject:function(a){a=k(this,a);this.g?l(this,a):this.l&&this.l.g?l(this.l,a):this.fnerr&&this.fnerr(a)}};
function k(a,b){function c(a){try{return a?JSON.stringify(a):"na"}catch(m){return"could not stringify"}}var d="string"==typeof b?b:"object"==typeof b?b.sError?b.sError:"A task was rejected":"A task was rejected",e="id:("+a.id+") ";e+="task:("+a.u+") ";e+="args:("+c(a._args)+") ";e+="sdftError:("+a.sdftError+") ";e+="sError:("+c(d)+") ";return{ix:a.ix,id:a.id,sErrorTask:a.u,args:a._args,sdftError:a.sdftError,sError:d,sStack:e}}
function l(a,b){for(var c=0,d=a.a.length,e=0;e<d;e++)if(a.a[e].o){c=e;break}a.a.splice(0,c);a.g=!1;a._args.v=b;a._next()}function g(a,b){var c=a.fnstat;a.i&&(c=function(a){console.log(a.__guid_async__+" ("+a.ix+"/"+a.h+") -> "+a.f)});c&&c({__guid_async__:a.__guid_async__,f:b||"",h:a.h,ix:a.ix,w:100*a.ix/a.h})}
function f(a,b){a.h++;b.__guid_async__=a.__guid_async__;if(a.j){b.s=!0;var c=a.a.length;if(c){for(var d=0;d<c;d++){var e=!1;if(!a.a[d].s){e=!0;a.a.splice(d,0,b);break}}e||a.a.push(b)}else a.a.push(b)}else a.a.push(b)};
