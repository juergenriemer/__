<html>
<script>
if( /\?min/.test( self.location.href ) ) {
	document.write( '<sc'+'ript src="__.DOM.min.js"></sc'+'ript>' );
}
else {
	document.write( '<sc'+'ript src="__.DOM.js"></sc'+'ript>' );
}
</script>
<body>
<style>
.one {
	color : red;
}
</style>

<div id="result" style="xposition:fixed;width:90%;height:200px;border:1px solid blue;overflow:auto"></div>
<h2>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</h2>
<h2>xxx</h2>
<h2>xxx</h2>
<h2>xxx</h2>
<h2>xxx</h2>
<h2>xxx</h2>
<h2>xxx</h2>
<div id="xxx" style="height:100px;width:400px;overflow:scroll;">
<h2 class='top'>LEFTtoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptoptopRIGHT</h2>
<h2>inner</h2>
<h2>inner</h2>
<h2>inner</h2>
<h2>inner</h2>
<h2>inner</h2>
<h2>inner</h2>
<h2 class='bottom'>LEFTbottombottombottombottombottombottombottombottombottombottombottomRIGHT</h2>

</div>
<div id="output"><h1>Unit test __.DOM.js</h1></div>

<script>
var dnResult = __find( "#result" );
cAsserts = 0;
bErrors = false;
assert = function( h, eh, s ) {
	cAsserts++;
	if( h === eh ) {
		sResult = "OK: " + s + "<br>";
	}	
	else {
		bErrors = true;
		sResult = "ERR: " + s + "<br>";
		console.warn( "ERR: " + s );
		console.warn( "actually", h );
		console.warn( "expected", eh );
	}
	dnResult.innerHTML = sResult + dnResult.innerHTML; 
}

dnOutput = __find( "#output" );
h = dnOutput.innerHTML;
eh = "<h1>Unit test __.DOM.js</h1>";
assert( h, eh, "__ (id)" );

// query
var h = " \
	<h3>navi</h3> \
	<div id='menu'> \
		<ul> \
			<li class='lvl_one'><a href='#1'>one</a></li> \
			<li class='lvl_one test'><a href='#2'>two</a> \
				<ul> \
					<li><a href='#2_1'>two.one</a></li> \
					<li class='active'><a href='#2_2'>two.two</a> \
				</ul> \
			</li> \
			<li class='lvl_one'><a href='#3'>three</a></li> \
		</ul> \
	</div> \
	<div id='footer'> \
		<a href='#f1'>f1</a> | \
		<a href='#f2' class='active'>f2</a> | \
		<a href='#f3'>f3</a> | \
	</div> \
";

var dnNavi = __append( h );
var dnMenu = dnNavi[ 1 ];
var dnFooter = dnNavi[ 2 ];

es = 'two.two';
s = dnMenu.__find( ".active" ).textContent.trim();
assert( s, es, "__find (css selector class )" );

es = 'two.two';
s = dnMenu.__find( "[href='#2_2']" ).textContent;
assert( s, es, "__find (css selector attr )" );

es = 'two.two';
s = dnMenu.__find( ".active [href='#2_2']" ).textContent;
assert( s, es, "__find (css selector class/attr )" );

es = 'two.onetwo.two';
s = '';
dnMenu.__find( "ul>li:nth-child(2)>ul>li", function( dn ) {
	s += dn.textContent.trim();
} )
assert( s, es, "__find (css selector direct rout)" );

es = 'onetwotwo.onetwo.twothree';
s = '';

dnMenu.__find( "li.lvl_one", function( dn ) {
	s += dn.textContent.replace( /\s/g, "" );
} )
assert( s, es, "__find (css selector li.lvl_one)" );


// dn.__closest

var dnActiveMenu = dnMenu.__find( ".active" );
assert( dnActiveMenu.__closest( "div" ).id, "menu", "__closest (menu)" );

var dnActiveFooter = dnFooter.__find( ".active" );
assert( dnActiveFooter.__closest( "div" ).id, "footer", "__closest (footer)" );

var dnLink = __find( "[href='#2_2']" );

var bClass = dnLink.__closest( "li" ).classList.contains( "active" );
assert( bClass, true, "__closest (li)" );

var bClass = dnLink.__closest( "li.lvl_one" ).classList.contains( "test" );
assert( bClass, true, "__closest (li.lvl_one)" );

// dn.__show/dn.__hide
dnLink.__hide();
assert( dnLink.style.display, "none", "dn.__hide(inline)" );

dnLink.__show();
assert( dnLink.style.display, "inline", "dn.__show(inline)" );

dnMenu.__hide();
assert( dnMenu.style.display, "none", "dn.__hide(block)" );

dnMenu.__show();
assert( dnMenu.style.display, "block", "dn.__show(block)" );

// dn.__ix

var dnFooterLink = __find( "[href='#f3']" );
assert( dnFooterLink.__ix( dnFooterLink ), 2, "dn.__ix (dnFooterLink)" );

assert( dnLink.__closest( "li" ).__ix(), 1, "dn.__ix (dnLink)" );

// dn.__x/__y/__dx/__dz
dnMenu.__x( "100" );
dnMenu.__y( "200" );
dnMenu.__dx( "400" );
dnMenu.__dy( "400" );
__css( "padding", 0 );
__css( "margin", 0 );
__css( "background", "#efefef" );
assert( dnMenu.__x(), 90, "dn.__x (dnMenu)" );
assert( dnMenu.__y(), 190, "dn.__y (dnMenu)" );
assert( dnMenu.__dx(), 400, "dn.__dx (dnMenu)" );
assert( dnMenu.__dy(), 400, "dn.__dy (dnMenu)" );

// __.dn.each/dn.__remove

var en = 2;
var n = dnMenu.__find( "ul" ).length;
assert( n, en, "__find (tagname)" );

__.dn.each( dnNavi, function( dn ) {
	dn.__remove();
} )
assert( __find( "#menu" ), null, "__.dn.each/del (menu)" );
assert( __find( "#footer" ), null, "__.dn.each/del (footer)" );


dnH1 = __find( "h1" );
s = dnH1.innerHTML;
es = "Unit test __.DOM.js";
assert( s, es, "__find (tagname)" );

// create/move in document body 

//var dnTop = prepend( "<div>prepend</div>" );
// does not return node! var dnSani = __prepend( "<div id='sani'>xxx</div>" );

//var dnBottom = __append( "<div>prepend</div>" );

// create/move in nodes 

dnAppend = dnOutput.__append( "<b>append</b>" );
h = dnOutput.innerHTML;
eh = "<h1>Unit test __.DOM.js</h1><b>append</b>";
assert( h, eh, "__append (string)" );

dnPrepend = dnOutput.__prepend( "<b>prepend</b>" );
h = dnOutput.innerHTML;
eh = "<b>prepend</b><h1>Unit test __.DOM.js</h1><b>append</b>";
assert( h, eh, "__prepend (string)" );

dnBefore = dnH1.__before( "<i>before</i>" );
h = dnOutput.innerHTML;
eh = "<b>prepend</b><i>before</i><h1>Unit test __.DOM.js</h1><b>append</b>";
assert( h, eh, "__before (string)" );

dnAfter = dnH1.__after( '<i class="after">after</i>' );
h = dnOutput.innerHTML;
eh = '<b>prepend</b><i>before</i><h1>Unit test __.DOM.js</h1><i class="after">after</i><b>append</b>';
assert( h, eh, "__after (string)" );

// move 
dnClass = __find( ".after" );
s = dnClass.textContent;
es = "after";
assert( s, es, "__find (classname)" );

dnBefore.__append( dnClass );
h = dnOutput.innerHTML;
eh = '<b>prepend</b><i>before<i class="after">after</i></i><h1>Unit test __.DOM.js</h1><b>append</b>';
assert( h, eh, "__append (node)" );

dnBefore.__before( dnClass );
h = dnOutput.innerHTML;
eh = '<b>prepend</b><i class="after">after</i><i>before</i><h1>Unit test __.DOM.js</h1><b>append</b>';
assert( h, eh, "__before (node)" );

dnBefore.__prepend( dnClass );
h = dnOutput.innerHTML;
eh = '<b>prepend</b><i><i class="after">after</i>before</i><h1>Unit test __.DOM.js</h1><b>append</b>';
assert( h, eh, "__prepend (node)" );

dnBefore.__after( dnClass );
h = dnOutput.innerHTML;
eh = '<b>prepend</b><i>before</i><i class="after">after</i><h1>Unit test __.DOM.js</h1><b>append</b>';
assert( h, eh, "__after (node)" );

// add to document
dnOutput_2 = __append( "<div><h1>output2</h1></div>" );
s = dnOutput_2.innerHTML;
es = "<h1>output2</h1>";
assert( s, es, "__append (to document)" );

// multiple nodes as string 
dnH1_2 = dnOutput_2.__find( "h1" );
dnAppend = dnH1_2.__append( "<b>1</b><i>2</i>" );
h = dnOutput_2.innerHTML;
eh = "<h1>output2<b>1</b><i>2</i></h1>";
assert( h, eh, "__append (multiple string)" );

dnPrepend = dnH1_2.__prepend( "<b>3</b><i>4</i>" );
h = dnOutput_2.innerHTML;
eh = "<h1><b>3</b><i>4</i>output2<b>1</b><i>2</i></h1>";
assert( h, eh, "__prepend (multiple string)" );

dnBefore = dnH1_2.__before( "<b>5</b><i>6</i>" );
h = dnOutput_2.innerHTML;
eh = "<b>5</b><i>6</i><h1><b>3</b><i>4</i>output2<b>1</b><i>2</i></h1>";
assert( h, eh, "__before (multiple string)" );

dnAfter = dnH1_2.__after( "<b>7</b><i>8</i>" );
h = dnOutput_2.innerHTML;
eh = "<b>5</b><i>6</i><h1><b>3</b><i>4</i>output2<b>1</b><i>2</i></h1><b>7</b><i>8</i>";
assert( h, eh, "__after (multiple string)" );

// moving single dom node
var dnTarget = __append( '<div><div class="inner"><b>middle</b></div></div>' );
var dnMove = __append( "<b>MOVE</b>" );
var dnInner = dnTarget.__find( ".inner" );

dnInner.__before( dnMove );
h = dnTarget.innerHTML;
eh = '<b>MOVE</b><div class="inner"><b>middle</b></div>';
assert( h, eh, "__before (single DOM node)" );

dnInner.__prepend( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>MOVE</b><b>middle</b></div>';
assert( h, eh, "__prepend (single DOM node)" );

dnInner.__append( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>middle</b><b>MOVE</b></div>';
assert( h, eh, "__append (single DOM node)" );

dnInner.__after( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>middle</b></div><b>MOVE</b>';
assert( h, eh, "__after (single DOM node)" );

// moving multiple dom nodes
dnTarget.__remove();
dnMove.__remove();
var dnTarget = __append( '<div><div class="inner"><b>middle</b></div></div>' );

var dnMove = __append( "<b>MOVE</b><i>YES</i>" );
var dnInner = dnTarget.__find( ".inner" );

dnInner.__before( dnMove );
h = dnTarget.innerHTML;
eh = '<b>MOVE</b><i>YES</i><div class="inner"><b>middle</b></div>';
assert( h, eh, "__before (multiple DOM node)" );

dnInner.__prepend( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>MOVE</b><i>YES</i><b>middle</b></div>';
assert( h, eh, "__prepend (multiple DOM node)" );

dnInner.__append( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>middle</b><b>MOVE</b><i>YES</i></div>';
assert( h, eh, "__append (multiple DOM node)" );

dnInner.__after( dnMove );
h = dnTarget.innerHTML;
eh = '<div class="inner"><b>middle</b></div><b>MOVE</b><i>YES</i>';
assert( h, eh, "__after (multiple DOM node)" );

var dnScrollDiv = __find( "#xxx" );
var dnScrollDivTop = dnScrollDiv.__find( ".top" );
var dnScrollDivBottom = dnScrollDiv.__find( ".bottom" );

setTimeout( function() {
	__scrollTo( "top" );
	__scrollTo( "left" );
	dnScrollDiv.__scrollTo( "top" );
	dnScrollDiv.__scrollTo( "left" );
}, 0 );


setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, true, "dn.__onScroll (node bottom-bBbottom)" );
		assert( aInfo.bTop, false, "dn.__onScroll (node bottom-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (node bottom-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (node bottom-bRight)" );
		dnScrollDiv.__offScroll();
	}, 50 );
	dnScrollDiv.__scrollTo( "bottom" );
}, 100 );
setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (node top-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (node top-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (node top-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (node top-bRight)" );
		dnScrollDiv.__offScroll();
	}, 50 );
	dnScrollDiv.__scrollTo( "top" );
}, 200 );
setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (node right-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (node right-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (node right-bLeft)" );
		assert( aInfo.bRight, true, "dn.__onScroll (node right-bRight)" );
		dnScrollDiv.__offScroll();
	}, 50 );
	dnScrollDiv.__scrollTo( "right" );
}, 300);
setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (node left-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (node left-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (node left-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (node left-bRight)" );
		dnScrollDiv.__offScroll();
	}, 5 );
	dnScrollDiv.__scrollTo( "left" );
}, 400 );
setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (node x-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (node x-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (node x-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (node x-bRight)" );
		dnScrollDiv.__offScroll();
	}, 5 );
	dnScrollDiv.__scrollTo( "x", 10 );
}, 500 );
setTimeout( function() {
	dnScrollDiv.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (node y-bBottom)" );
		assert( aInfo.bTop, false, "dn.__onScroll (node y-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (node y-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (node y-bRight)" );
		dnScrollDiv.__offScroll();
	}, 5 );
	dnScrollDiv.__scrollTo( "y", 10 );
}, 600 );



// scroll on window



setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, true, "dn.__onScroll (window bottom-bBbottom)" );
		assert( aInfo.bTop, false, "dn.__onScroll (window bottom-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (window bottom-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (window bottom-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "bottom" );
}, 1700 );
setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (window top-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (window top-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (window top-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (window top-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "top" );
}, 1800 );
setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (window right-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (window right-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (window right-bLeft)" );
		assert( aInfo.bRight, true, "dn.__onScroll (window right-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "right" );
}, 1900);
setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (window left-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (window left-bTop)" );
		assert( aInfo.bLeft, true, "dn.__onScroll (window left-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (window left-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "left" );
}, 2000 );
setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (window x-bBottom)" );
		assert( aInfo.bTop, true, "dn.__onScroll (window x-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (window x-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (window x-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "x", 10 );
}, 2100 );
setTimeout( function() {
	document.__onScroll( function( aInfo ) {
		assert( aInfo.bBottom, false, "dn.__onScroll (window y-bBottom)" );
		assert( aInfo.bTop, false, "dn.__onScroll (window y-bTop)" );
		assert( aInfo.bLeft, false, "dn.__onScroll (window y-bLeft)" );
		assert( aInfo.bRight, false, "dn.__onScroll (window y-bRight)" );
		document.__offScroll();
	}, 5 );
	__scrollTo( "y", 10 );
}, 2200 );

// __each 

var sTags = "";
__find( "div" ).__each( function( dn ) {
	sTags += dn.tagName;
} )
assert( sTags, "DIVDIVDIVDIVDIVDIV", "dn.__each" );

ecAsserts = 95
setTimeout( function() {
	if( cAsserts == ecAsserts && ! bErrors ) {
		document.body.style.background = "green";
	}		
	else {
		document.body.style.background = "red";
	}
}, 3000 );
</script>
</body>
</html>



